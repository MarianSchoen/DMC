#' write_result_list
#'
#' @param results.all list of lists, as generated by the 'benchmark()' function
#' @param filename string, where should the data be stored?
#' @param group string, group name for the hdf5 file
#'
#' @return NULL, function saves into ‘filename‘
write_result_list <- function(results.all, filename, group = NULL){
  library(rhdf5)
  # not sure what kind of safety checks one could use here
  # results.all is either output of deconvolute/simulation functions or function will fail somewhere
  if(!file.exists(filename)) h5createFile(filename)
  if(any(sapply(results.all, function(x){is.list(x)}))){
    for(name in names(results.all)){
      if(!is.null(group)){
        groupname <- paste(group, name, sep = "/")
      }else{
        groupname <- name
      }
      h5createGroup(filename, groupname)
      if(is.list(results.all[[name]])){
        write_result_list(results.all[[name]], filename, groupname)
      }else{
        if(name == "bulk.props"){
          h5write(as.matrix(results.all[[name]]), filename, paste(groupname, "data", sep = "/"))
          h5write(as.vector(rownames(results.all[[name]])), filename, paste(groupname, "celltypeids", sep = "/"))
          h5write(as.vector(colnames(results.all[[name]])), filename, paste(groupname, "bulkids", sep = "/"))
        }
      }
    }
  }else{
    if(!is.null(results.all[["est.props"]])){
      h5createGroup(filename, paste(group, "est.props", sep = "/"))
      h5write(as.matrix(results.all[["est.props"]]), filename, paste(group, "est.props", "data", sep = "/"))
      h5write(as.vector(rownames(results.all[["est.props"]])), filename, paste(group, "est.props", "celltypeids", sep = "/"))
      h5write(as.vector(colnames(results.all[["est.props"]])), filename, paste(group, "est.props", "bulkids", sep = "/"))
    }
    if(!is.null(results.all[["sig.matrix"]])){
      h5createGroup(filename, paste(group, "sig.matrix", sep = "/"))
      h5write(as.matrix(results.all[["sig.matrix"]]), filename, paste(group, "sig.matrix", "data", sep = "/"))
      h5write(as.vector(rownames(results.all[["sig.matrix"]])), filename, paste(group, "sig.matrix", "geneids", sep = "/"))
      h5write(as.vector(colnames(results.all[["sig.matrix"]])), filename, paste(group, "sig.matrix", "celltypeids", sep = "/"))
    }
    h5write(results.all[["name"]], filename, paste(group, "name", sep = "/"))
    h5write(results.all[["times"]], filename, paste(group, "times", sep = "/"))
  }
}
